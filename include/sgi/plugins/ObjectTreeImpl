// kate: syntax C++11;
// SGI - Copyright (C) 2012-2015 FAST Protect, Andreas Roth

#pragma once

#include "SGIPluginInterface.h"

class QTreeWidgetItem;

namespace sgi {

class IObjectTreeImpl : public osg::Referenced
{
public:
    virtual void    itemSelected(IObjectTreeItem * oldItem, IObjectTreeItem * newItem) = 0;
    virtual void    itemContextMenu(IObjectTreeItem * item, IContextMenuPtr & contextMenu) = 0;
    virtual void    itemExpanded(IObjectTreeItem * item) = 0;
    virtual void    itemCollapsed(IObjectTreeItem * item) = 0;
    virtual void    itemActivated(IObjectTreeItem * item) = 0;
    virtual void    itemClicked(IObjectTreeItem * item) = 0;
};
typedef osg::ref_ptr<IObjectTreeImpl> IObjectTreeImplPtr;

class ObjectTreeItem : public IObjectTreeItem
{
public:
    static SGIPluginHostInterface * s_hostInterface;

    ObjectTreeItem (QTreeWidget * widget, IObjectTreeImpl * impl, SGIPluginHostInterface * hostInterface);
    ObjectTreeItem (QTreeWidgetItem * item, SGIPluginHostInterface * hostInterface);
    ObjectTreeItem(const ObjectTreeItem & item);
    virtual ~ObjectTreeItem();

    IObjectTreeItem * root() override;
    IObjectTreeItem * parent() override;

    void clear()  override;
    IObjectTreeItem * addChild(const std::string & name, SGIItemBase * item) override;
    IObjectTreeItem * addChild(const std::string & name, const SGIHostItemBase * hostitem) override;

    IObjectTreeItem * findChild(const std::string & name) override;

    IObjectTreeItem * addChildIfNotExists(const std::string & name, SGIItemBase * item) override;
    IObjectTreeItem * addChildIfNotExists(const std::string & name, const SGIHostItemBase * hostitem) override;

    void setSelected(bool select) override;
    bool isSelected() const override;

    SGIItemBase * item() override;
    void expand() override;
    void collapse() override;

    QTreeWidgetItem * treeItem();
    const QTreeWidgetItem * treeItem() const;

    void children(IObjectTreeItemPtrList & children) override;

    void reload() override;

    IObjectTreeItem * selectedItem() override;

    void setName(const std::string & name) override;
    void updateName() override;

protected:
    IObjectTreeItem * addChildImpl(const std::string & name, SGIItemBase * item);
    static void addDummyChild(QTreeWidgetItem * itemParent);

private:
    SGIPluginHostInterface * _hostInterface;
    QTreeWidgetItem * _item;
};

typedef osg::ref_ptr<IObjectTreeItem> IObjectTreeItemPtr;

} // namespace sgi
